<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fengxiu.club","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine | disqus","storage":true,"lazyload":true,"nav":{"disqus":{"text":"评论","order":-1},"valine":{"text":"评论","order":-2}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录学习日志">
<meta property="og:type" content="website">
<meta property="og:title" content="枫秀学习日志">
<meta property="og:url" content="http://fengxiu.club/index.html">
<meta property="og:site_name" content="枫秀学习日志">
<meta property="og:description" content="记录学习日志">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="枫秀">
<meta property="article:tag" content="java">
<meta property="article:tag" content="spring">
<meta property="article:tag" content="分布式">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://fengxiu.club/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>枫秀学习日志</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="枫秀学习日志" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫秀学习日志</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">枫秀学习日志</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">101</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">57</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">198</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/43453.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/43453.html" class="post-title-link" itemprop="url">InnoDB行格式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-01 14:25:20 / 修改时间：14:25:39" itemprop="dateCreated datePublished" datetime="2022-04-01T14:25:20+00:00">2022-04-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mysql/" itemprop="url" rel="index"><span itemprop="name">Mysql</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mysql/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/43453.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/43453.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/43453.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/43453.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>InnoDB是mysql数据库中最常用的存储引擎，对其底层进行研究有助于理解常见的一些数据库优化思路。本篇文章介绍一条记录是如何存储在磁盘上。</p>
<p>我们平时都是以记录为单位向表中插入数据的，这些记录在磁盘上的存放形式也被称为行格式或者记录格式。InnoDB存储引擎到现在为止设计了4种不同类型的行格式，<br>分别是COMPACT、REDUNDANT、DYNAMI、COMPRESSED。其中REDUNDANT是最早使用的数据格式，现在基本上不怎么使用。目前使用较多的是其它三种格式，这三种格式基本相似，只在处理变长字段上有不同。下文将首先介绍COMPACT格式，然后在以此对比来说明另外俩种格式。</p>
<h2 id="COMPACT行格式"><a href="#COMPACT行格式" class="headerlink" title="COMPACT行格式"></a>COMPACT行格式</h2><p>定义一张表，方便后面举例说明</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> record_format_demo(</span><br><span class="line">cl <span class="type">VARCHAR</span>(<span class="number">10</span>), </span><br><span class="line">c2 <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">c3 <span class="type">CHAR</span>(<span class="number">10</span>) , </span><br><span class="line">c4 <span class="type">VARCHAR</span>(<span class="number">10</span>) </span><br><span class="line">) CHARSET<span class="operator">=</span>ascii ROW_FORMAT<span class="operator">=</span>COMPACT</span><br></pre></td></tr></table></figure>

<p>插入俩条数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> record_format_demo </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;aaaa&#x27;</span> , <span class="string">&#x27;bbb&#x27;</span> , &quot; CC&#x27; , &#x27;d&#x27;) , (&#x27;eeee&#x27; , &#x27;fff&#x27;, NULL ,NULL) ;</span><br></pre></td></tr></table></figure>

<p>COMPACT行格式的基本结构如下图<br><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220401145842.png" alt="行格式"></p>
<p>一共分成俩部分额外信息和记录的真实数据。额外信息是为了更好的管理记录。</p>
<h3 id="额外信息"><a href="#额外信息" class="headerlink" title="额外信息"></a>额外信息</h3><h4 id="变长字段列表"><a href="#变长字段列表" class="headerlink" title="变长字段列表"></a>变长字段列表</h4><p>MySQL 支持一些变长的数据类型，比如 VARCHAR(M)、 BINARY(M)、各种 TEXT 类型、各种 BLOB 类型.我们也可以把拥有这些数据类型的列称为变长字段。变长字段中存储多少字节的数据是不固定的，所以我们在存储真实数据的时候需要顺便把这些数<br>据占用的字节数也存起来。</p>
<p>record_format_demo表的cl c2 c4列都是VARCHAR类型的，也就是变长的数据类型，所以这 个列的值占用的存储空间字节数都需要保存在记录开头处。同时record_format_demo表采用的是ASCII编码，每个字符只需要一个字节编码。另外在存储长度的时候，是按照列的逆序进行存储的。因此对于记录 (‘aaaa’ , ‘bbb’ , “ CC’ , ‘d’)，相应的变长字段存储内容是  <code>01 03 04</code>（十六进制表示，真实存储没有空格）。</p>
<p>如果变长字段的内容占用的字节数比较多 可能就需要用 字节来表示。至于用字节还是字节来表示变长字段的真实数据占用的字节数，InnoDB 它的一套规则.为<br>了更好地表述清楚这个规则，我们引入 W、M、L这几个符号，先分别看看这些符号的意思</p>
<ul>
<li>W 表示最多需要多少个字节来表示字符</li>
<li>M 表示最多能存储多少个字符，比如varchar(10)，m&#x3D;10</li>
<li>L表示实际字段存储需要用到的长度</li>
</ul>
<p>确定使用1字节还是2字节来表示一个变长字段的真实数据占用的字节数的规则就是这样。</p>
<ul>
<li>如果W * M &lt;&#x3D; 255 ，那么使用1字节来表示真实数据占用的字节数.</li>
<li>如果大于255 ，则分为下面两种情况。如果L&lt;127 ，则用1字节来表示真实数据占用的字节数。如果L &gt;127 ，则用2字节来表示真实数据占用的字节数</li>
</ul>
<p>此外变长字段只存储非NULL字段。</p>
<p>另外对于CHAR类型的字段，如果表采用的编码方式是变长的，比如UTF-8，则此字段就是变长字段，如果采用的是定长字段，比如Ascii，则此字段就是定长。另外还有一点需要注意，采用变长编码字符集的CHAR(M)类型的列要求至少占M个字节,VARCHAR却没有这个要求。比如对于使用utf8字符集、类型为CHAR(10)的列来说，该列存储的数据占用的字节长度的范围就是10 - 30 字节.即使我们向该列中存储一个空字符串也会占用10字节，这主要是希望在将来更新该列时， 在新值的字节长度大于 字节长度但不大于10个字节 ，可以在该记录处直接更新.而不是在存储空间中再重新分配一个新的记录空间，导致原有的记录空间成为所谓的碎片。</p>
<h4 id="NULL值列表"><a href="#NULL值列表" class="headerlink" title="NULL值列表"></a>NULL值列表</h4><p>NULL值列表存储比较耗费存储，因此对于NULL值字段，采用二进制的方式进行存储。<br>对于字段中允许NULL值的字段，按照列的顺序逆序进行排列。NULL值则用0表示，有值则用1表示。Mysql规定NULL值列表必须用整数个字节的位表示，如果使用的二进制位个数不是整数个字节，则在字节的高位补</p>
<p>对于记录<code>(&#39;eeee&#39; , &#39;fff&#39;, NULL ,NULL) </code>对应的NULL值列表对应的二进制列表<code>0000 0110</code>。</p>
<h4 id="记录头信息"><a href="#记录头信息" class="headerlink" title="记录头信息"></a>记录头信息</h4><p>记录头信息由固定的5字节组成，用于描述记录的一些属性。主要的内容如下</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220401175150.png" alt="记录头"></p>
<p>可以知道有这些信息，具体用到的时候再回来看。</p>
<h3 id="记录真实数据"><a href="#记录真实数据" class="headerlink" title="记录真实数据"></a>记录真实数据</h3><p>表中除了存储真实的数据，还会为每个记录默认地添加一些列(也称为隐藏列)。</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220401180149.png"></p>
<p>这里需要提一下InnoDB表的主键生成策略,优先使用用户自定义的主键作为主键，如果用户没有定义主键 则选取一个不允许存储NULL值的UNIQUE键作为主键,如果表中连不允许存储NULL值的UNIQUE键都没有定义，则会为表默认添加一个名为 row_id 隐藏列作为主键.</p>
<p>因此row_id是可选的，另外俩列和事务有关。</p>
<h3 id="溢出列"><a href="#溢出列" class="headerlink" title="溢出列"></a>溢出列</h3><p>对于某些列，存储的内容可能大于16kB，而InnoDB是以页为基本单位来管理存储空间的，一页的大小是16kB，所以当前页是不能存储这份内容，对于这样的列称之为溢出列。</p>
<p>COMPACT行格式中 ，对于占用存储空间非常多的列 ，在记录的真实数据处只会存储该列的部分数据，而把剩余的数据分散存储在几个其他的页中然后在记录的真实数据处用20字节存储指向这些页的地址(当然字节还包括分散在其他页面中的数据所占用的字节数) ，从而可以找到剩余数据所在的页。</p>
<p>如果某一列中的数据非常多，则在本记录的真实数据处只会存储该列前768字节的数据以及一个指向其他页的址，然后把剩下的数据存放到其他页中。这些存储768字节之外的数据的页面也称为溢出页.</p>
<p>例子如下：</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220401185343.png"></p>
<h2 id="DYNAMIC-行格式和-COMPRESSED-行格式"><a href="#DYNAMIC-行格式和-COMPRESSED-行格式" class="headerlink" title="DYNAMIC 行格式和 COMPRESSED 行格式"></a>DYNAMIC 行格式和 COMPRESSED 行格式</h2><p>下面来看另外两个行格式DYNAMIC行格式和 COMPRSSED行格式。这两个行格式与 COMPACT行格式挺像，只不过在处理溢出列的数据时有点儿分歧 它们不会在记录的真实数据处存储该溢出列真实数据的前768字节，而是把该列的所有真实数据都存储到溢出页中，只在记录的真实数据处存储20节大小的指向溢出页的地址(当然，这 20 字节还包括真实数据占用的字节数)。COMPRESSED行格式不同DYNAMIC行格式的一点是 COMPRESSED行格式会采用压缩算法进行压缩。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li>Mysql是怎样运行的</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/6735.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/6735.html" class="post-title-link" itemprop="url">本地事务表 (An Acid Alternative)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-28 19:19:51" itemprop="dateCreated datePublished" datetime="2022-03-28T19:19:51+00:00">2022-03-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E7%BF%BB%E8%AF%91/" itemprop="url" rel="index"><span itemprop="name">翻译</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/6735.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/6735.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/6735.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/6735.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文翻译自<a target="_blank" rel="noopener" href="https://queue.acm.org/detail.cfm?id=1394128">Base: An Acid Alternative</a>。</p>
<p>在分区数据库中，用一致性换取可用性可以显著提高可伸缩性。</p>
<p>Web应用程序在过去十年中越来越流行。无论您是为终端用户还是为应用程序开发人员（服务）构建应用程序，您最希望的是您的应用程序将获得广泛采用，并且随着广泛采用，将带来事务性增长。如果应用程序依赖持久性，那么数据存储可能会成为瓶颈。</p>
<p>有两种策略可以扩展任何应用程序。第一个，也是迄今为止最简单的，是垂直扩展：将应用程序移动到更大的计算机上。垂直缩放对数据的效果相当好，但有几个限制。最明显的限制是超出了最大系统的容量。垂直扩展也很昂贵，因为增加事务处理能力通常需要购买下一个更大的系统。垂直扩展通常会造成供应商锁定，进一步增加成本。</p>
<p>水平缩放提供了更大的灵活性，但也相当复杂。水平数据缩放可以沿两个方向执行。功能扩展涉及按功能对数据进行分组，并将功能组分布在数据库中。将功能区域内的数据跨多个数据库拆分，或进行切分，即第二种策略。下图解释了水平数据缩放策略。</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328195213.png" alt="图1"></p>
<p>如图1所示，两种水平缩放方法都可以同时应用。用户、产品和事务可以位于单独的数据库中。此外，每个功能区域可以在多个数据库中拆分，以获得事务处理能力。如图所示，功能区域可以相互独立地缩放。</p>
<p><strong>功能分区</strong></p>
<p>功能分区对于实现高度的可伸缩性很重要。任何好的数据库体系结构都会将模式分解为按功能分组的表。用户、产品、交易和沟通都是功能领域的例子。利用外键等数据库概念是维护这些功能领域一致性的常用方法。</p>
<p>依靠数据库约束来确保功能组之间的一致性，可以将模式与数据库部署策略耦合起来。为了应用约束，这些表必须驻留在单个数据库服务器上，从而防止随着事务速率的增长而进行水平扩展。在许多情况下，最简单的扩展机会是将数据的功能组移动到离散的数据库服务器上。<br>可以扩展到非常高的事务量的模式将在不同的数据库服务器上放置功能不同的数据。这需要将数据约束从数据库中移出，并转移到应用程序中。本文还介绍了本文后面将讨论的几个挑战。</p>
<p><strong>CAP理论</strong></p>
<p>一致性： 客户端感知到一组操作同时发生。<br>有效性：每个操作都必须以预期的响应结束。<br>分区容错性：即使单个组件不可用，操作也将完成。</p>
<p>具体来说，Web应用程序在任何数据库设计中最多只能支持其中两个属性。显然，任何水平扩展策略都是基于数据分区的；因此，设计师不得不在一致性和可用性之间做出决定。</p>
<p><strong>ACID</strong> </p>
<p>ACID数据库事务大大简化了应用程序开发人员的工作。正如首字母缩略词所示，ACID交易提供以下保证：<br>原子性: 事务中的所有操作都将完成，或者不完成。<br>一致性: 当事务开始和结束时，数据库将处于一致状态。<br>隔离性: 事务的行为就像它是对数据库执行的唯一操作一样。<br>持久性: 交易完成后，该操作将不会被撤销。</p>
<p>数据库供应商很久以前就认识到需要对数据库进行分区，并引入了一种称为2PC（两阶段提交）的技术，用于跨多个数据库实例提供ACID保证。该协议分为两个阶段：</p>
<ul>
<li><p>首先，事务协调器要求涉及的每个数据库预提交操作，并指示是否可以提交。如果所有数据库都同意可以继续提交，则第2阶段开始。<br>事务协调器要求每个数据库提交数据。</p>
</li>
<li><p>如果任何数据库否决了提交，那么所有数据库都会被要求回滚其事务部分。缺点是什么？我们正在跨分区实现一致性。如果Brewer是正确的，那么我们必须影响可用性，但这怎么可能呢？</p>
</li>
</ul>
<p>任何系统的可用性都是运行所需组件可用性的产物。声明的最后一部分是最重要的。系统可能使用但不需要的组件不会降低系统可用性。在2PC提交中涉及两个数据库的事务将具有每个数据库可用性的乘积的可用性。例如，如果我们假设每个数据库有99.9%的可用性，那么事务的可用性将变为99.8%，或者每月额外停机43分钟。</p>
<p><strong>ACID另外选择</strong></p>
<p>如果ACID为分区数据库提供了一致性选择，那么如何实现可用性呢？一个答案是BASE（基本可用，软状态，最终一致）。</p>
<p>BASE与ACID截然相反。如果ACID是悲观的，并在每个操作结束时强制保持一致性，那么BASE是乐观的，并接受数据库一致性将处于不断变化的状态。虽然这听起来不可能解决，但实际上它是相当容易管理的，并且会导致使用ACID无法获得的可伸缩性级别。</p>
<p>BASE的可用性是通过支持部分故障而不是全部系统故障来实现的。下面是一个简单的例子：如果用户被划分到五个数据库服务器上，那么BASE方式鼓励以这样一种方式精心设计操作，即用户数据库故障只影响该特定主机上20%的用户。这不需要魔法，但这确实会提高系统的可用性。</p>
<p>那么，既然您已经将数据分解为功能组，并在多个数据库中划分了最繁忙的组，那么如何将BASE整合到应用程序中呢？与通常应用于ACID相比，BASE需要对逻辑事务中的操作进行更深入的分析。你应该找什么？以下几节提供了一些指导。</p>
<p><strong>一致性模式</strong></p>
<p>按照Brewer的推测，如果BASE允许分区数据库中的可用性，那么必须确定放松一致性的要求。这通常很困难，因为业务涉众和开发人员都倾向于断言一致性对应用程序的成功至关重要。时间上的不一致性无法对最终用户隐藏，因此工程和产品所有者都必须参与选择放松一致性的要求。</p>
<p>下图是一个简单的模式，说明了BASE的一致性注意事项。用户表保存用户信息，包括销售和购买的总金额，这些是总数。交易表保存了每笔交易，涉及卖方和买方以及交易金额。这些都是对实际表格的过度简化，但包含了说明一致性的几个方面的必要元素。</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200406.png" alt="图2"></p>
<p>一般来说，功能组之间的一致性比功能组内部的一致性更容易降低要求。示例模式有两个功能组：用户和事务。每次出售商品时，都会向交易表中添加一行，并更新买家和卖家的计数器。使用ACID样式的事务，SQL将如图3所示。</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200634.png"></p>
<p>用户表中的总买卖列可以被视为事务表的缓存。这是为了提高系统的效率。有鉴于此，对一致性的约束可以放松。可以设定买方和卖方的预期，使其运行余额不会立即反映交易结果。这种情况并不罕见，事实上，人们经常会在交易和日常余额之间遇到这种延迟（例如ATM取款和手机通话）。</p>
<p>如何修改SQL语句以放松一致性取决于如何定义运行平衡。如果它们只是估计，意味着可能会错过一些事务，那么更改就非常简单，如图4所示。</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200722.png"></p>
<p>我们现在已经将用户表和事务表的更新解耦。不能保证表之间的一致性。事实上，第一个和第二个事务之间的故障将导致用户表永久不一致，但如果合同规定运行总数是估计数，这可能就足够了。<br>但是，如果估计是不可接受的呢？您如何仍然将用户和事务更新解耦？引入持久消息队列可以解决这个问题。实现持久消息有几种选择。然而，实现队列的最关键因素是确保备份持久性与数据库位于同一资源上。这对于允许在不涉及2PC的情况下以事务方式提交队列是必要的。现在，SQL操作看起来有些不同，如图5所示。</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200750.png"></p>
<p>这个例子在语法上有一定的自由度，并且过分简化了逻辑来说明这个概念。通过在与insert相同的事务中对持久消息进行排队，可以捕获更新用户上的运行余额所需的信息。事务包含在单个数据库实例中，因此不会影响系统可用性。<br>一个单独的消息处理组件将对每条消息进行出列，并将信息应用于用户表。这个例子似乎解决了所有问题，但有一个问题。消息持久性在事务主机上，以避免排队期间出现2PC。如果消息在涉及用户主机的事务中出列，我们仍然有2PC的情况。<br>消息处理组件中2PC的一个解决方案是什么都不做。通过将更新分离到一个单独的后端组件中，可以保持面向客户的组件的可用性。对于业务需求，消息处理器的可用性较低可能是可以接受的。<br>然而，假设2PC在您的系统中永远不可接受。这个问题怎么解决？首先，你需要理解幂等的概念。如果一个运算可以应用一次或多次并得到相同的结果，则该运算被认为是幂等的。幂等运算之所以有用，是因为它们允许部分故障，因为反复应用它们不会改变系统的最终状态。<br>所选示例在寻找幂等性时存在问题。更新操作很少是幂等的。该示例在适当的位置增加平衡列。多次使用此操作显然会导致不正确的平衡。然而，即使只是设置值的更新操作，在操作顺序方面也不是幂等的。如果系统无法保证更新将按接收顺序应用，则系统的最终状态将不正确。稍后再详细介绍。<br>在余额更新的情况下，您需要一种方法来跟踪哪些更新已成功应用，哪些更新尚未完成。一种技术是使用记录已应用的事务标识符的表。<br>图6所示的表跟踪了交易ID（余额已被更新）和应用余额的用户ID。现在，我们的示例伪代码如图7所示。</p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200822.png"></p>
<p><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200835.png"><br>本例取决于能否窥视队列中的消息，并在成功处理后将其删除。如有必要，这可以通过两个独立的事务来完成：一个在消息队列上，另一个在用户数据库上。除非数据库操作成功提交，否则不会提交队列操作。该算法现在支持部分故障，并且仍然提供事务性保证，而无需求助于2PC。<br>如果唯一关心的是排序，那么有一种更简单的方法来确保幂等更新。让我们稍微更改一下示例模式，以说明挑战和解决方案（参见图8）。假设您还希望为用户跟踪最后的销售和购买日期。你可以依靠一个类似的方案，用消息更新日期，但有一个问题。<br><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200901.png"></p>
<p>假设两次购买发生在一个短时间窗口内，我们的消息系统不能确保有序的操作。现在的情况是，根据消息的处理顺序，最后一次购买的值不正确。幸运的是，这种更新只需对SQL稍加修改即可处理，如图9所示。<br><img src="https://raw.githubusercontent.com/fengxiu/img/master/20220328200929.png"></p>
<p>通过简单地不允许最后一次购买时间倒转，您已经使更新操作顺序独立。您还可以使用这种方法来保护任何更新不受无序更新的影响。除了使用时间，您还可以尝试单调递增的事务ID。</p>
<p><strong>消息队列的排序</strong></p>
<p>对有序消息传递进行简单说明是有必要的。消息系统提供了确保消息按接收顺序发送的能力。这可能需要昂贵的支持，而且往往是不必要的，事实上，有时会给人一种虚假的安全感。</p>
<p>这里提供的示例说明了如何放宽消息排序，并最终提供数据库的一致视图。放宽排序所需的开销是名义上的，并且在大多数情况下明显低于在消息系统中强制排序。</p>
<p>此外，无论交互方式如何，Web应用程序在语义上都是事件驱动的系统。客户端请求以任意顺序到达系统。每个请求所需的处理时间各不相同。整个系统组件中的请求调度是不确定的，导致消息队列不确定。要求保留顺序会给人一种虚假的安全感。简单的现实是，不确定的输入将导致不确定的输出。</p>
<p><strong>软状态&#x2F;最终一致(Soft State&#x2F;Eventually Consistent)</strong></p>
<p>到目前为止，重点一直放用一致性换区可用性上。更重要的是需要理解软状态和最终一致性对应用程序设计的影响。</p>
<p>作为软件工程师，我们倾向于将系统视为闭环。我们从可预测的投入产生可预测的产出的角度来考虑他们行为的可预测性。这是创建正确软件系统的必要条件。在许多情况下，好消息是使用BASE不会改变系统作为闭环的可预测性，但它确实需要从整体上观察行为。</p>
<p>一个简单的例子可以帮助说明这一点。考虑一个系统，用户可以将资产转移给其他用户。资产的类型无关紧要——可能是钱，也可能是游戏中的物品。在本例中，我们将假设我们已将两个操作解耦，即从一个用户获取资产，并使用用于提供解耦的消息队列将其提供给另一个用户。</p>
<p>马上，这个系统就会感到不确定性和问题。有一段时间资产离开了一个用户而没有到达另一个用户。此时间窗口的大小可由消息传递系统设计决定。无论如何，在开始和结束状态之间存在一个延迟，其中两个用户似乎都没有资产。</p>
<p>然而，如果我们从用户的角度考虑这一点，这种滞后可能不相关或甚至是已知的。接收用户和发送用户都不知道资产何时到达。如果发送和接收之间的延迟为几秒钟，对于转移资产的双方，是看不到的或者是肯定可以接受的。在这种情况下，系统行为被认为是一致的，用户可以接受，尽管我们依赖于软状态和实现中的最终一致性。</p>
<p><strong>事件驱动架构</strong></p>
<p>如果您确实需要知道状态何时变得一致，该怎么办？您可能有需要应用于该状态的算法，但仅当它达到与传入请求相关的一致状态时。简单的方法是依赖于在状态变得一致时生成的事件。<br>继续上一个示例，如果需要通知用户资产已到达，该怎么办？在事务中创建将资产提交给接收用户的事件，提供了一种机制，用于在达到已知状态后执行进一步处理。EDA（事件驱动体系结构）可以在可伸缩性和体系结构解耦方面提供显著的改进。关于EDA应用的进一步讨论超出了本文的范围。</p>
<p><strong>总结</strong></p>
<p>将系统扩展到惊人的交易率需要一种新的资源管理方式。当负载需要分布在大量组件上时，传统的事务模型是有问题的。分离操作并依次执行这些操作可以提高可用性和可扩展性，但代价是一致性。BASE为思考这种脱钩提供了一个模型。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/59493.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/59493.html" class="post-title-link" itemprop="url">seata简单总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-28 14:34:49" itemprop="dateCreated datePublished" datetime="2022-03-28T14:34:49+00:00">2022-03-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/59493.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/59493.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/59493.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/59493.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>50</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>收集信息</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">官网</a></li>
<li><a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Seata/">at模式教程</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000038480562">Seata TCC模式事务</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mltds/sagas-report">SAGAS论文翻译</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6969550464744423437">SAGAS原理分析</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040321750">分布式事务的总结</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/21834.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/21834.html" class="post-title-link" itemprop="url">快速生成测试数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-22 17:11:44" itemprop="dateCreated datePublished" datetime="2022-03-22T17:11:44+00:00">2022-03-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/test/" itemprop="url" rel="index"><span itemprop="name">test</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/21834.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/21834.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/21834.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/21834.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>日常在写单元测试过程中，如何构造合适的测试数据是比较麻烦并且乏味的。本篇将介绍俩个工具用于生成测试数据，首先介绍<a target="_blank" rel="noopener" href="https://www.datafaker.net/documentation/getting-started/">Datafaker</a>，此工具用于生成各种常见的测试数据。接着介绍<a target="_blank" rel="noopener" href="https://github.com/j-easy/easy-random/wiki">easy-random</a>,用于生成测试对象。最后介绍如何结合这俩个工具生成比较真实的测试对象。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/archives/21834.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/1930.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/1930.html" class="post-title-link" itemprop="url">spring之aop源码解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-14 17:58:06" itemprop="dateCreated datePublished" datetime="2022-03-14T17:58:06+00:00">2022-03-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/aop/" itemprop="url" rel="index"><span itemprop="name">aop</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/aop/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">源码解析</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/1930.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/1930.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/1930.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/1930.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本篇文章主要用来记录研究aop源码的过程。</p>
<h2 id="aop-基本概念"><a href="#aop-基本概念" class="headerlink" title="aop 基本概念"></a>aop 基本概念</h2><ul>
<li>方面（Aspect）：跨越多个类的模块化关注点。事务管理是企业Java应用程序中横切关注点的一个很好的例子。在SpringAOP中，方面是通过使用常规类（基于xml的方法）或使用@Aspect注解（@Aspectj样式）注解的常规类来实现的。</li>
<li>连接点（Join point）：程序执行过程中的一点，如方法的执行或异常的处理。在SpringAOP中，连接点总是表示一个方法执行。</li>
<li>通知（Advice）：一个方面在特定连接点采取的行动。不同类型的通知包括“环绕”、“前“和”后”通知。（稍后将讨论通知类型。）许多AOP框架（包括Spring）将通知建模为拦截器，并在连接点周围维护拦截器链。</li>
<li>切点（Pointcut）：与连接点匹配的谓词。通知与切入点表达式关联，并在与切入点匹配的任何连接点上运行（例如，使用特定名称执行方法）。pointcut表达式匹配的连接点概念是AOP的核心，Spring默认使用AspectJ pointcut表达式语言。</li>
<li>引入（Introduction）：代表类型声明其他方法或字段。SpringAOP允许你向任何advised对象引入新的接口（和相应的实现）。例如，你可以使用一个Introduction使bean实现一个IsModified接口，以简化缓存。（introduction在AspectJ社区中称为类型间声明。）</li>
<li>目标对象（Target object）：由一个或多个方面advised的对象。也称为“advised 对象”。因为SpringAOP是通过使用运行时代理实现的，所以这个对象始终是一个代理对象。</li>
<li>AOP代理：由AOP框架创建的用于实现aspect contracts（通知方法执行等）的对象。在Spring框架中，AOP代理是JDK动态代理或CGLIB代理。</li>
<li>编织（Weaving）：将aspects与其他应用程序类型或对象链接，以创建advised的对象。这可以在编译时（例如，使用AspectJ编译器）、加载时或运行时完成。Spring AOP和其他纯Java AOP框架一样，在运行时进行编织。</li>
</ul>
<p>Spring AOP包含以下几种通知类型：</p>
<ul>
<li>Before advice:在连接点之前运行但不能阻止执行到连接点的通知（除非它抛出异常）。</li>
<li>After returning advice:在连接点正常完成后要运行的通知（例如，如果方法返回并且不引发异常）。</li>
<li>After throwing advice: 如果方法通过引发异常而退出，则要执行的通知。</li>
<li>After (finally) advice:无论连接点退出的方式如何（正常或异常返回），都要执行的通知。</li>
<li>Around advice:环绕连接点（如方法调用）的通知。这是最有力的通知。around通知可以在方法调用前后执行自定义行为。它还负责通过返回自己的返回值或引发异常来选择是继续到连接点还是快捷地执行通知的方法。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/archives/1930.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/undefined.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/undefined.html" class="post-title-link" itemprop="url">spring之@import注解使用与源码解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-10 14:39:08" itemprop="dateCreated datePublished" datetime="2022-03-10T14:39:08+00:00">2022-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-01 11:03:04" itemprop="dateModified" datetime="2022-04-01T11:03:04+00:00">2022-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/undefined.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/undefined.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/undefined.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/undefined.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本篇文章记录对@Import注解学习的整个过程。首先文章会介绍@Import注解的使用，接着分析下spring是如何处理@Import注解，最后通过@EnableAsync来举例说明该类型注解实现的原理。</p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p>大体上有三种用法</p>
<ol>
<li>引入其它Configuration</li>
<li>初始化其它的bean</li>
<li>个性化加载bean</li>
</ol>
<p>下面依次介绍这三种的用法，首先定义几个类，方便后面的讲解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ServiceInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;                      </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceA</span> <span class="keyword">implements</span> <span class="title class_">ServiceInterface</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ServiceA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceB</span> <span class="keyword">implements</span> <span class="title class_">ServiceInterface</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ServiceB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="引入configuration"><a href="#引入configuration" class="headerlink" title="引入configuration"></a>引入configuration</h3><p>创建了俩个Config类，其中ConfigA通过@Import引入ConfigB，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(ConfigB.class)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigA</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> ServiceInterface <span class="title function_">getServiceA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServiceA</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigB</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> ServiceInterface <span class="title function_">getServiceB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServiceB</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时这里也使用了ConditionalOnMissingBean注解，主要用于判断哪个bean先生成。</p>
<p>通过ConfigA创建AnnotationConfigApplicationContext，获取ServiceInterface，看是哪种实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(ConfigA.class);</span><br><span class="line">    <span class="type">ServiceInterface</span> <span class="variable">bean</span> <span class="operator">=</span> ctx.getBean(ServiceInterface.class);</span><br><span class="line">    bean.test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为：ServiceB.证明@Import的优先于本身的的类定义加载。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/archives/undefined.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/22104.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/22104.html" class="post-title-link" itemprop="url">Spring类型转换整理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-11 06:46:00" itemprop="dateCreated datePublished" datetime="2021-11-11T06:46:00+00:00">2021-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-01 11:03:04" itemprop="dateModified" datetime="2022-04-01T11:03:04+00:00">2022-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/22104.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/22104.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/22104.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/22104.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring类型转换整理"><a href="#Spring类型转换整理" class="headerlink" title="Spring类型转换整理"></a>Spring类型转换整理</h1><!-- 

https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#core-convert-ConversionService-API

https://blog.csdn.net/f641385712/article/details/90702928

https://juejin.im/post/6844903940484513806

1. BeanWrapperImpl 大致原理 https://juejin.im/post/6844904047070167054#heading-4
2. convert 包的基本使用
3. fromat的基本使用
 -->
<p> 平常在使用Spring过程中，经常会用到类型转换，但一直没时间对这一块进行系统的整理。因此接下来会用几篇文章对这一块进行系统的整理。</p>
<p>大概的想法是下面俩篇：</p>
<ol>
<li>Spring类型转换整理</li>
<li>BeanWrapper使用以及原理</li>
<li>DataBinder使用以及原理</li>
</ol>
<p>这篇文章用于记录自己在学习Spring类型转换相关的内容，主要有以下三块。</p>
<ol>
<li>PropertyEditor：用于String到Object的类型转换</li>
<li>Conver      ：用于Object到Object之间的转换</li>
<li>Format      ：主要用于格式化，将对象转换成指定格式的字符串，比如Date和string之间的转换
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/archives/22104.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/f7de8aa8.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/f7de8aa8.html" class="post-title-link" itemprop="url">外观模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-28 10:09:53" itemprop="dateCreated datePublished" datetime="2021-08-28T10:09:53+00:00">2021-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-01 11:03:04" itemprop="dateModified" datetime="2022-04-01T11:03:04+00:00">2022-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/f7de8aa8.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/f7de8aa8.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/f7de8aa8.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/f7de8aa8.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h1><p>外观模式是一种结构型设计模式， 能为程序库、 框架或其他复杂类提供一个简单的接口。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设你必须在代码中使用某个复杂的库或框架中的众多对象。 正常情况下， 你需要负责所有对象的初始化工作、 管理其依赖关系并按正确的顺序执行方法等。</p>
<p>最终， 程序中类的业务逻辑将与第三方类的实现细节紧密耦合， 使得理解和维护代码的工作很难进行。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/archives/f7de8aa8.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/f5c535ea.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/f5c535ea.html" class="post-title-link" itemprop="url">适配器模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-28 10:09:53" itemprop="dateCreated datePublished" datetime="2021-08-28T10:09:53+00:00">2021-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-01 11:03:04" itemprop="dateModified" datetime="2022-04-01T11:03:04+00:00">2022-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/f5c535ea.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/f5c535ea.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/f5c535ea.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/f5c535ea.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h1><p>适配器模式是一种结构型设计模式， 它能使接口不兼容的对象能够相互合作。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你正在开发一款股票市场监测程序， 它会从不同来源下载 XML 格式的股票数据， 然后向用户呈现出美观的图表。</p>
<p>在开发过程中， 你决定在程序中整合一个第三方智能分析函数库。 但是遇到了一个问题， 那就是分析函数库只兼容 JSON 格式的数据。<br><img src="https://raw.githubusercontent.com/fengxiu/img/master/problem-zh-2x.png" alt="problem-zh-2x"></p>
<p>你可以修改程序库来支持 XML。 但是， 这可能需要修改部分依赖该程序库的现有代码。 甚至还有更糟糕的情况， 你可能根本没有程序库的源代码， 从而无法对其进行修改。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/archives/f5c535ea.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fengxiu.club/archives/b4c41cf9.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="枫秀">
      <meta itemprop="description" content="记录学习日志">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫秀学习日志">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/archives/b4c41cf9.html" class="post-title-link" itemprop="url">inux 查看文件命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-28 10:09:53" itemprop="dateCreated datePublished" datetime="2021-07-28T10:09:53+00:00">2021-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-01 11:03:04" itemprop="dateModified" datetime="2022-04-01T11:03:04+00:00">2022-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/archives/b4c41cf9.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="archives/b4c41cf9.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/b4c41cf9.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/b4c41cf9.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="linux-查看文件命令"><a href="#linux-查看文件命令" class="headerlink" title="linux 查看文件命令"></a>linux 查看文件命令</h1><p>当我们在进行调试的时候，经常需要查看各种日志文件，这时候熟悉linux下一些常用的查看文件命令是非常重要的，本篇文章专门整理了这些常用的命令，主要有下面几个。</p>
<ol>
<li>tail</li>
<li>cat</li>
<li>more</li>
</ol>
<h2 id="tail命令"><a href="#tail命令" class="headerlink" title="tail命令"></a>tail命令</h2><p>ltail命令用途是依照要求将指定的文件的最后部分输出到标准设备，通常是终端，通俗讲来，就是把某个文件的最后几行显示到终端上，假设该文件有更新，tail会自己主动刷新，确保你看到最新的文件内容。</p>
<h3 id="tail命令语法"><a href="#tail命令语法" class="headerlink" title="tail命令语法"></a>tail命令语法</h3><p>tail [ -f ] [ -c Number | -n Number | -m Number | -b Number | -k Number ]  [-r]  [ File ]</p>
<p>参数解释：</p>
<ol>
<li>-f 该参数用于监视File文件动态增长。</li>
<li>-c Number 从 Number 字节位置读取指定文件</li>
<li>-n Number 从 Number 行位置读取指定文件。</li>
<li>-m Number 从 Number 多字节字符位置读取指定文件，比方你的文件假设包括中文字，假设指定-c参数，可能导致截断，但使用-m则会避免该问题。</li>
<li>-b Number 从 Number 表示的512字节块位置读取指定文件。</li>
<li>-k Number 从 Number 表示的1KB块位置读取指定文件。</li>
<li>-r 这个会似的按照现实内容相反的顺序现实，具体见下面例子 </li>
<li>File 指定操作的目标文件名称</li>
</ol>
<p>上述命令中，都涉及到number，假设不指定，默认显示10行。Number前面可使用正负号，表示该偏移从顶部还是从尾部开始计算。这个具体看下面例子。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/archives/b4c41cf9.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="枫秀"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">枫秀</p>
  <div class="site-description" itemprop="description">记录学习日志</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">198</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">101</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">枫秀</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">20:46</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://fengxiu.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'ljY0VjHRpXGNJajqYEG9usUd-gzGzoHsz',
      appKey     : 'kK371eQflnC992Bf2YhhdBjM',
      placeholder: "",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
